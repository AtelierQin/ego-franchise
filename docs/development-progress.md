# 逸刻新零售加盟商一体化管理与赋能平台 - 开发进度文档

## 项目概述

**项目名称：** 逸刻新零售加盟商一体化管理与赋能平台 (MVP - 完整扩展版)

**项目愿景：** 快速搭建一个核心流程线上化平台，支持逸刻招商团队、运营团队与加盟商完成从意向申请到日常运营、支持、沟通及基础品控、结算的全生命周期管理，初步验证平台的一体化赋能价值，为后续全面数字化转型奠定坚实基础。

## 开发计划

### 核心模块 (Core)

#### Core.1 用户认证与角色
- [ ] **FR-Core.1.1:** 支持用户注册（仅限意向加盟商 Applicant，注册后需管理员激活或审核通过才可登录）。
- [ ] **FR-Core.1.2 (Admin):** 管理员可创建总部员工账号（HQ Recruiter, HQ Ops, HQ Supervisor, HQ Finance, Admin）并分配角色。
- [ ] **FR-Core.1.3 (Admin):** 管理员可管理加盟商账号（如：在合同签署后将其从 Applicant 激活/转换为 Franchisee 角色，或禁用账号）。
- [x] **FR-Core.1.4:** 所有用户支持邮箱/密码登录。提供“忘记密码”功能。 (已实现基础登录页面、AuthContext集成)
- [ ] **FR-Core.1.5:** 系统内定义清晰的角色：Applicant, Franchisee, HQ Recruiter, HQ Ops, HQ Supervisor, HQ Finance, Admin。
- [ ] **FR-Core.1.6:** 基于角色实现严格的数据访问权限和功能操作权限（通过 Supabase RLS 和前端逻辑控制）。

### 阶段一：项目初始化与基础架构搭建

- [x] 分析PRD文档，确定项目范围和技术栈
- [x] 创建Vite+React项目（使用TypeScript）
- [x] 配置Tailwind CSS和自定义主题色（#00B0B9和#FF9800）
- [x] 设置Supabase客户端配置和基础枚举类型
- [x] 创建Bento Grid布局样式组件
- [x] 创建基础布局和导航结构 (通过 `App.tsx` 中的 `Layout` 组件和 `react-router-dom` 实现，后续根据模块持续优化)

### 模块A: 招商与签约 (简化版)

#### A.1 加盟商在线申请与审核
- [x] **FR-A.1.1 (Applicant):** 提供在线加盟申请表单，字段包括：姓名、联系电话、邮箱、意向城市、预计投入资金、简要经验描述。
- [x] **FR-A.1.2 (Applicant):** 支持上传资质文件（如身份证扫描件，数量1-3个，格式 PDF/JPG/PNG，大小限制）。
- [x] **FR-A.1.3 (Applicant):** 提交申请后，可查看申请状态（待审核、审核中、已通过、已驳回、需补充材料）。
- [x] **FR-A.1.4 (HQ Recruiter):** 收到新申请的系统内通知。（进行中）
- [x] **FR-A.1.5 (HQ Recruiter):** 查看申请人信息和上传的资质文件。（进行中 - 对应原"创建申请审核界面"）
- [x] **FR-A.1.6 (HQ Recruiter):** 对申请进行操作：批准、驳回（需填写原因）、要求补充材料（需填写说明）。审批意见内部可见。（进行中 - 对应原"创建申请审核界面"）
- [ ] **FR-A.1.7 (Admin):** 可配置基础的自动化初筛规则（例如：意向城市是否在开放列表内）。

#### A.2 电子合同签署 (简化版)
- [x] **FR-A.2.1 (HQ Recruiter/Admin):** 上传1-2个标准版PDF合同模板到系统。(已实现合同预览功能)
- [x] **FR-A.2.2 (HQ Recruiter):** 选择已批准的申请人，选择合同模板，手动输入需填写的关键变量，发起签署流程。(已开发电子签名组件并实现合同签署流程)
- [x] **FR-A.2.3 (Applicant/Franchisee & HQ):** 收到签署通知（邮件/短信），在线预览合同，进行电子签名。
- [x] **FR-A.2.4 (Applicant/Franchisee & HQ):** 双方签署完成后，可在线查看和下载已签署的PDF合同。(已实现合同查看与管理功能)
- [x] **FR-A.2.5 (HQ Recruiter):** 跟踪合同签署状态（待签署、部分签署、已签署）。
- [x] **FR-A.2.6:** 合同签署完成后，申请人状态自动更新为“已签约加盟商 (Franchisee)”。

### 模块B: 开店筹备 (极简版 - 聚焦首批订货)

#### B.1 首批订货
- [x] **FR-B.1.1 (Admin/HQ Ops):** 管理商品信息。（进行中）
- [x] **FR-B.1.2 (Franchisee):** 登录后可浏览商品列表，商品列表可按分类查看，可按名称搜索。（进行中）
- [x] **FR-B.1.3 (Franchisee):** 将商品加入购物车，可修改购物车中商品数量，可从购物车移除商品。（进行中）
- [x] **FR-B.1.4 (Franchisee):** 确认购物车商品后，提交订单。订单生成时记录收货信息。
- [x] **FR-B.1.5 (Franchisee):** 查看订单详情及状态。
- [x] **FR-B.1.6 (HQ Ops):** 收到新订单（区分首批订单/日常订单）的系统内通知。
- [x] **FR-B.1.7 (HQ Ops):** 查看订单详情，确认订单，更新订单状态。

### 模块C: 日常运营与支持 (扩展版)

#### C.1 日常订货
- [x] **FR-C.1.1 (Franchisee):** 登录后可浏览商品列表，进行日常补货下单。
- [x] **FR-C.1.2 (Franchisee):** 可查看个人历史订单记录列表，可点击查看订单详情。
- [x] **FR-C.1.3 (Franchisee):** “再来一单”功能。
- [x] **FR-C.1.4 (HQ Ops):** 处理日常订单，更新订单状态。

#### C.2 基础经营数据看板 (基于平台订货数据)
- [x] **FR-C.2.1 (Franchisee):** 仪表盘概览：本月订货总金额、上月订货总金额、本月订单数。
- [x] **FR-C.2.2 (Franchisee):** 最近N笔订单列表。
- [x] **FR-C.2.3 (Franchisee):** 订货商品排行 Top N。
- [x] **FR-C.2.4 (Franchisee):** 简单的月度订货金额趋势图。

#### C.3 基础工单支持
- [x] **FR-C.3.1 (Franchisee):** 创建工单：选择问题分类，填写问题标题和详细描述，可上传图片附件。
- [x] **FR-C.3.2 (Franchisee):** 查看自己提交的工单列表，可点击查看工单详情及回复。
- [x] **FR-C.3.3 (HQ Ops):** 收到新工单通知，查看工单列表。
- [x] **FR-C.3.4 (HQ Ops):** 查看工单详情，可在工单内进行回复，更新工单状态。
- [x] **FR-C.3.5 (Franchisee & HQ Ops):** 工单内可进行简单的文本追问追答，形成沟通记录。

### 模块D: 财务结算与对账 (基础版)

#### D.1 费用记录与支付提醒 (简化版)
- [x] **FR-D.1.1 (HQ Finance/HQ Ops):** 系统自动（或手动触发）生成对应的货款应付记录。
- [x] **FR-D.1.2 (HQ Finance):** HQ Finance 角色可访问货款记录列表，并手动更新货款支付状态。
- [x] **FR-D.1.3 (Franchisee):** 可查看自己的待支付货款列表。
- [x] **FR-D.1.4 (Franchisee):** 可查看历史货款支付记录列表。

#### D.2 基础对账提醒
- [x] **FR-D.2.1 (HQ Finance/Admin):** 系统每月初（或手动触发）能汇总上一个自然月内每个加盟商订单的总货款金额及当前未支付货款总额。
- [x] **FR-D.2.2 (HQ Finance):** HQ Finance 可查看此汇总信息，并通过系统内消息或邮件发送给加盟商作为对账参考。

### 模块E: 巡店与品控管理 (基础版)

#### E.1 基础巡店记录
- [x] **FR-E.1.1 (Admin/HQ Supervisor):** 可预设一个简单的巡店检查清单模板。
- [x] **FR-E.1.2 (HQ Supervisor):** 移动端友好界面。选择要巡检的加盟门店，基于预设的模板进行巡店。
- [x] **FR-E.1.3 (HQ Supervisor):** 对每个检查项进行结果记录，填写文字描述，可上传照片 (附件上传为前端模拟，待对接Supabase Storage)。
- [x] **FR-E.1.4 (HQ Supervisor):** 填写整体巡店总结或建议。
- [x] **FR-E.1.5 (HQ Supervisor):** 提交巡店记录。
- [x] **FR-E.1.6 (Franchisee):** 可查看针对本店的历史巡店记录列表，点击可查看详细巡店报告。

### 模块F: 总部公告与沟通 (基础版)

#### F.1 总部公告发布与查阅
- [x] **FR-F.1.1 (HQ Ops/Admin):** 创建公告：填写公告标题、正文内容，可上传1个附件 (附件上传为前端模拟，待对接Supabase Storage)。
- [x] **FR-F.1.2 (HQ Ops/Admin):** 选择公告接收对象。
- [x] **FR-F.1.3 (HQ Ops/Admin):** 可设置公告重要等级。
- [x] **FR-F.1.4 (HQ Ops/Admin):** 发布公告。 (已实现发布、编辑、删除逻辑)
- [x] **FR-F.1.5 (Franchisee):** 登录后在“通知公告”区域看到新公告列表。
- [x] **FR-F.1.6 (Franchisee):** 点击公告标题可查看公告详情及附件。
- [x] **FR-F.1.7 (Franchisee):** 阅读公告后，可手动点击“标记为已读”按钮。
- [ ] **FR-F.1.8 (HQ Ops/Admin):** 可查看已发布公告的阅读统计（待后端支持）。

## 当前进度

**当前阶段：** 核心功能完善、Supabase深度集成与测试

**已完成：**
- PRD文档分析，项目范围和技术栈确定
- Vite+React+TypeScript项目初始化
- Tailwind CSS和自定义主题色配置
- Bento Grid布局样式组件创建
- Supabase客户端配置和基础枚举类型设置
- 基础布局和导航结构搭建
- **模块A (招商与签约):**
  - FR-A.1.1, FR-A.1.2, FR-A.1.3: 加盟商在线申请、文件上传、状态查看
  - FR-A.2.1 - FR-A.2.6: 电子合同签署全流程
- **模块B (开店筹备):**
  - FR-B.1.4, FR-B.1.5, FR-B.1.6, FR-B.1.7: 订单提交、详情查看、通知、处理
- **模块C (日常运营与支持):**
  - FR-C.1.1 - FR-C.1.4: 日常订货全流程
  - FR-C.2.1 - FR-C.2.4: 基础经营数据看板
  - FR-C.3.1 - FR-C.3.5: 基础工单支持全流程
- **模块D (财务结算与对账):**
  - FR-D.1.1 - FR-D.1.4: 费用记录与支付提醒
  - FR-D.2.1 - FR-D.2.2: 基础对账提醒
- **模块E (巡店与品控管理):**
  - FR-E.1.1, FR-E.1.2, FR-E.1.4, FR-E.1.5, FR-E.1.6: 基础巡店记录 (除真实文件上传外)
- **模块F (总部公告与沟通):**
  - FR-F.1.2 - FR-F.1.7: 公告创建参数、发布、查阅、标记已读 (除真实文件上传和阅读统计外)
- **核心模块 (Core):**
  - FR-Core.1.4: 用户认证基础功能（登录页面、AuthContext集成）

**进行中：**
- **核心模块 (Core.1) 用户认证与角色管理:**
  - [ ] 实现用户认证与角色管理 (Supabase Auth 深度集成及细化权限控制) (FR-Core.1.1, FR-Core.1.2, FR-Core.1.3, FR-Core.1.5, FR-Core.1.6)
- **模块A - 招商与签约：**
  - [x] FR-A.1.4 (HQ Recruiter): 新申请系统内通知
  - [x] FR-A.1.5 (HQ Recruiter): 查看申请人信息和上传的资质文件
  - [x] FR-A.1.6 (HQ Recruiter): 对申请进行操作
- **模块B - 开店筹备：**
  - [x] FR-B.1.1 (Admin/HQ Ops): 管理商品信息
  - [x] FR-B.1.2 (Franchisee): 浏览商品列表、分类查看、名称搜索
  - [x] FR-B.1.3 (Franchisee): 购物车功能
- **模块E - 巡店与品控管理：**
  - [ ] FR-E.1.3: 将巡店记录中的照片上传真实对接 Supabase Storage。
- **模块F - 总部公告与沟通：**
  - [ ] FR-F.1.1: 将公告附件上传逻辑真实对接 Supabase Storage。

**下一步重点开发任务：**

1.  **完成进行中的任务：**
    *   **模块A (招商与签约):** 完成 FR-A.1.4, FR-A.1.5, FR-A.1.6 的开发和测试。
    *   **模块B (开店筹备):** 完成 FR-B.1.1, FR-B.1.2, FR-B.1.3 的开发和测试。
2.  **核心模块 (Core.1) 用户认证与角色管理深度集成：**
    *   [ ] **FR-Core.1.1:** 实现意向加盟商 (Applicant) 用户注册流程，注册后需管理员激活或审核。
    *   [ ] **FR-Core.1.2 (Admin):** 开发管理员创建总部员工账号（HQ Recruiter, HQ Ops, HQ Supervisor, HQ Finance, Admin）并分配角色的功能。
    *   [ ] **FR-Core.1.3 (Admin):** 开发管理员管理加盟商账号功能（激活/转换为 Franchisee，禁用账号）。
    *   [ ] **FR-Core.1.5:** 在系统中清晰定义并使用 PRD 中规划的角色。
    *   [ ] **FR-Core.1.6:** 全面设计并实现基于 Supabase RLS 和前端逻辑的严格数据访问权限和功能操作权限控制。
3.  **Supabase Storage 对接：**
    *   [ ] **模块F (FR-F.1.1):** 实现公告附件上传至 Supabase Storage。
    *   [ ] **模块E (FR-E.1.3):** 实现巡店记录照片上传至 Supabase Storage。
    *   确保资质文件上传 (FR-A.1.2) 和工单附件上传 (FR-C.3.1) 已真实对接 Supabase Storage (若之前为模拟)。
4.  **未开始的 MVP 功能点：**
    *   [ ] **模块A (FR-A.1.7 Admin):** 开发基础自动化初筛规则配置功能。
    *   [ ] **模块F (FR-F.1.8 HQ Ops/Admin):** 开发公告阅读统计功能 (可先前端预留，待后端逻辑支持)。
5.  **测试与优化：**
    *   对已完成和新完成的功能进行单元测试和集成测试。
    *   根据测试反馈进行 Bug 修复和体验优化。
    *   重点测试角色权限控制 (FR-Core.1.6)。
6.  **文档：**
    *   [ ] 准备部署文档。
    *   [ ] 准备用户指南初稿。

## 技术栈

- **前端：** Vite + React (TypeScript), Tailwind CSS, Zustand, React Hook Form + Zod
- **UI组件库:** Shadcn/ui
- **富文本编辑器 (公告模块):** TipTap 或 react-markdown
- **图表库 (数据看板):** Recharts 或 Chart.js
- **文件上传组件:** react-dropzone 或集成UI库组件
- **后端：** Supabase (PostgreSQL, Auth, Storage, Edge Functions)
- **设计风格：** Bento Grid, 主题色 #00B0B9 和 #FF9800

## 更新日志

### 2025-05-13
- 初始化项目开发计划文档
- 完成PRD文档分析

### 2025-05-14
- 初始化Vite+React+TypeScript项目
- 配置Tailwind CSS和自定义主题色
- 完成加盟申请表单和资质文件上传功能
- 实现申请状态查看页面
- 完成合同签约相关组件开发
- 实现合同预览、电子签名和合同管理功能
- 开始模块B（开店筹备）的开发
- 设计商品管理功能架构
- 开始实现商品浏览与搜索界面
- 规划购物车功能实现方案
- 继续完善申请通知系统和审核界面
- 完成订单通知系统（FR-B.1.6）
- 实现订单处理与状态更新功能（FR-B.1.7）
- 创建OrderNotification组件，支持实时订单通知
- 开发OrderProcessing组件，支持订单状态更新和物流信息管理
- 开发模块C（日常运营与支持）的日常订货功能
- 创建DailyOrderList组件，实现历史订单查看和"再来一单"功能
- 开发DashboardOverview组件，实现基础经营数据看板
- 创建SupportTicket组件，实现工单创建、列表查看和回复功能
- 完成C.1、C.2和C.3模块的所有功能点
- 开发模块D（财务结算与对账）功能
- 创建货款记录相关类型定义和组件
- 实现费用记录与支付提醒功能
- 开发基础对账提醒功能
- 完成模块E（巡店与品控管理）功能
- 创建巡店记录相关类型定义和组件
- 实现巡店记录表单和列表功能
- 开发巡店管理主页面
- 开始开发模块F（总部公告与沟通）功能
- 创建公告相关类型定义
- 开发公告创建表单组件
- 实现公告列表组件
- 开始设计公告详情查看功能

### 2025-05-15
- 根据 PRD (`project_rules.md`) 重构开发进度文档结构。
- 详细比对 PRD 功能需求与当前开发进度，更新各功能点状态。
- 明确了进行中任务和下一步重点开发任务。