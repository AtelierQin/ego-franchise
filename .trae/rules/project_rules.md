
**产品需求文档 (PRD): 逸刻新零售加盟商一体化管理与赋能平台

**1. 项目概述**

*   **1.1 项目名称：** 逸刻新零售加盟商一体化管理与赋能平台 (MVP - 完整扩展版)
*   **1.2 项目愿景 (MVP)：** 快速搭建一个核心流程线上化平台，支持逸刻招商团队、运营团队与加盟商完成从意向申请到日常运营、支持、沟通及基础品控、结算的全生命周期管理，初步验证平台的一体化赋能价值，为后续全面数字化转型奠定坚实基础。
*   **1.3 项目目标 (MVP)：**
    1.  实现加盟商在线申请、总部在线审核与电子签约。
    2.  支持加盟商完成首批订货及日常补货。
    3.  为加盟商提供最基础的经营数据概览（基于其向总部的订货数据）。
    4.  提供基础的在线工单支持功能。
    5.  实现总部的基础公告发布与加盟商查阅。
    6.  支持基础的巡店记录与问题反馈（总部对加盟商）。
    7.  实现核心费用（如货款）的记录与基础对账提醒。
    8.  确保核心用户（加盟商、总部招商、总部运营、总部督导、总部财务初级）能够在该平台上完成其关键任务。
*   **1.4 目标用户 (MVP)：**
    *   意向加盟商 (Applicant)
    *   已签约/运营加盟商 (Franchisee)
    *   逸刻总部招商专员 (HQ Recruiter)
    *   逸刻总部运营专员 (HQ Ops - 负责订单处理、支持、公告)
    *   逸刻总部区域督导 (HQ Supervisor - 负责巡店)
    *   逸刻总部财务专员 (HQ Finance - 负责费用记录与对账提醒)
    *   系统管理员 (Admin - 基础用户与角色管理)

---

**2. MVP 核心模块与功能**

**模块A: 招商与签约 (简化版)**

*   **A.1 加盟商在线申请与审核**
    *   **用户故事:**
        *   作为意向加盟商，我希望能在线填写加盟申请表并上传必要的资质文件，并能看到我的申请状态。
        *   作为总部招商专员，我希望能收到新的加盟申请通知，在线查看申请材料，并进行审批（通过/驳回/要求补充材料）和记录审批意见。
    *   **功能需求 (FR):**
        1.  **FR-A.1.1 (Applicant):** 提供在线加盟申请表单，字段包括：姓名、联系电话、邮箱、意向城市、预计投入资金、简要经验描述。
        2.  **FR-A.1.2 (Applicant):** 支持上传资质文件（如身份证扫描件，数量1-3个，格式 PDF/JPG/PNG，大小限制）。
        3.  **FR-A.1.3 (Applicant):** 提交申请后，可查看申请状态（待审核、审核中、已通过、已驳回、需补充材料）。
        4.  **FR-A.1.4 (HQ Recruiter):** 收到新申请的系统内通知。
        5.  **FR-A.1.5 (HQ Recruiter):** 查看申请人信息和上传的资质文件。
        6.  **FR-A.1.6 (HQ Recruiter):** 对申请进行操作：批准、驳回（需填写原因）、要求补充材料（需填写说明）。审批意见内部可见。
        7.  **FR-A.1.7 (Admin):** 可配置基础的自动化初筛规则（例如：意向城市是否在开放列表内）。
    *   **关键数据点:** 申请人信息 (姓名, 电话, 邮箱, 意向城市, 资金, 经验), 资质文件链接, 申请ID, 申请时间, 申请状态, 审批人, 审批时间, 审批意见。

*   **A.2 电子合同签署 (简化版)**
    *   **用户故事:**
        *   作为总部招商专员，在加盟申请通过后，我希望能基于标准合同模板快速发起电子签署流程。
        *   作为加盟商，我希望能在线预览合同并完成电子签名，签署后能下载已签署的合同。
    *   **功能需求 (FR):**
        1.  **FR-A.2.1 (HQ Recruiter/Admin):** 上传1-2个标准版PDF合同模板到系统。
        2.  **FR-A.2.2 (HQ Recruiter):** 选择已批准的申请人，选择合同模板，手动输入需填写的关键变量（如加盟费金额、合同有效期起止），发起签署流程（集成第三方电子签服务）。
        3.  **FR-A.2.3 (Applicant/Franchisee & HQ):** 收到签署通知（邮件/短信），在线预览合同，进行电子签名。
        4.  **FR-A.2.4 (Applicant/Franchisee & HQ):** 双方签署完成后，可在线查看和下载已签署的PDF合同。
        5.  **FR-A.2.5 (HQ Recruiter):** 跟踪合同签署状态（待签署、部分签署、已签署）。
        6.  **FR-A.2.6:** 合同签署完成后，申请人状态自动更新为“已签约加盟商 (Franchisee)”。
    *   **关键数据点:** 合同ID, 关联申请ID, 合同模板ID, 合同变量 (JSON格式), 签署方信息, 签署状态, 已签署合同文件链接, 签署发起时间, 签署完成时间。
    *   **集成点:** 第三方电子签章服务 (如 eSign 或 DocuSign 的基础API)。

**模块B: 开店筹备 (极简版 - 聚焦首批订货)**

*   **B.1 首批订货**
    *   **用户故事:**
        *   作为新签约加盟商，我希望能看到可供订购的商品清单（含价格、规格），选择商品和数量完成首批订货。
        *   作为总部运营专员，我希望能收到新加盟商的首批订货订单并进行处理。
    *   **功能需求 (FR):**
        1.  **FR-B.1.1 (Admin/HQ Ops):** 管理商品信息：商品ID, 商品名称, SKU, 规格描述, 供货价, 单位, (可选)商品图片，库存状态 (简单标记：充足/紧张/缺货，或具体数量 - MVP可简化为充足/缺货)。
        2.  **FR-B.1.2 (Franchisee):** 登录后（合同签署完毕状态），可浏览商品列表，商品列表可按分类查看（若有分类），可按名称搜索。
        3.  **FR-B.1.3 (Franchisee):** 将商品加入购物车，可修改购物车中商品数量，可从购物车移除商品。
        4.  **FR-B.1.4 (Franchisee):** 确认购物车商品后，提交订单。订单生成时记录收货信息（MVP阶段可默认为加盟商注册地址，或允许手动填写一次性收货地址）。
        5.  **FR-B.1.5 (Franchisee):** 查看订单详情及状态（待处理、已确认/处理中、已发货、已完成/已收货 - 简单状态）。
        6.  **FR-B.1.6 (HQ Ops):** 收到新订单（区分首批订单/日常订单）的系统内通知。
        7.  **FR-B.1.7 (HQ Ops):** 查看订单详情，确认订单，更新订单状态（如：标记为已发货，并可填写物流单号 - MVP可简化，不强制物流单号）。
        8.  **(MVP 暂不做) 在线支付集成。** 支付流程MVP阶段可线下处理，平台仅记录订单和状态。后续财务模块会记录货款。
    *   **关键数据点:** 商品信息 (ID, 名称, SKU, 价格, 规格, 单位, 图片链接, 库存状态), 订单信息 (订单ID, 订单号, 加盟商ID, 订单类型-首批/日常, 商品明细[商品ID, 数量, 单价, 小计], 订单总金额, 订单状态, 下单时间, 收货地址, 物流单号-可选), 购物车信息。

**模块C: 日常运营与支持 (扩展版)**

*   **C.1 日常订货**
    *   **用户故事:**
        *   作为加盟商，我希望能方便地进行日常补货，并能参考历史订货记录。
        *   作为总部运营专员，我希望能高效处理日常补货订单。
    *   **功能需求 (FR):** (基本复用 B.1 的功能，但针对已开业加盟商)
        1.  **FR-C.1.1 (Franchisee):** 登录后可浏览商品列表，进行日常补货下单（购物车、提交订单流程同B.1）。
        2.  **FR-C.1.2 (Franchisee):** 可查看个人历史订单记录列表（含订单号、日期、金额、状态），可点击查看订单详情。
        3.  **FR-C.1.3 (Franchisee):** (可选MVP功能) “再来一单”功能：基于某个历史订单快速将商品加入购物车。
        4.  **FR-C.1.4 (HQ Ops):** 处理日常订单，更新订单状态（流程同B.1）。
    *   **关键数据点:** 同 B.1。

*   **C.2 基础经营数据看板 (基于平台订货数据)**
    *   **用户故事:** 作为加盟商，我希望能看到我从总部订货的一些基本数据，了解我的进货情况和成本。
    *   **功能需求 (FR):**
        1.  **FR-C.2.1 (Franchisee):** 仪表盘概览：本月订货总金额、上月订货总金额、本月订单数。
        2.  **FR-C.2.2 (Franchisee):** 最近N笔订单列表（订单号、日期、金额、状态）。
        3.  **FR-C.2.3 (Franchisee):** 订货商品排行 Top N (可按订货数量或订货金额，时间范围可选：近30天、近90天、全部)。
        4.  **FR-C.2.4 (Franchisee):** 简单的月度订货金额趋势图（柱状图或折线图，展示近6-12个月数据）。
        5.  **(MVP 暂不做) 与POS系统打通。** 数据仅来源于本平台的订货记录。
        6.  **(MVP 暂不做) 与总部平均水平或优秀门店对比。**
    *   **关键数据点:** 聚合后的历史订单数据 (按加盟商、按时间、按商品)。

*   **C.3 基础工单支持**
    *   **用户故事:**
        *   作为加盟商，当我遇到与平台操作、订单、政策等相关的问题时，我希望能提交一个工单给总部，并能看到处理进度和回复。
        *   作为总部运营专员，我希望能接收、分类和处理加盟商提交的工单，并进行回复。
    *   **功能需求 (FR):**
        1.  **FR-C.3.1 (Franchisee):** 创建工单：选择问题分类（预设简单分类如：订单问题、系统操作咨询、政策疑问、其他），填写问题标题和详细描述，可上传1-2张图片附件（用于问题说明）。
        2.  **FR-C.3.2 (Franchisee):** 查看自己提交的工单列表（工单号、标题、提交时间、状态），可点击查看工单详情及回复。
        3.  **FR-C.3.3 (HQ Ops):** 收到新工单通知，查看工单列表（可按状态、分类筛选 - MVP可简化为按状态）。
        4.  **FR-C.3.4 (HQ Ops):** 查看工单详情，可在工单内进行回复（文本），更新工单状态（待处理、处理中、已解决/已关闭）。
        5.  **FR-C.3.5 (Franchisee & HQ Ops):** 工单内可进行简单的文本追问追答，形成沟通记录。
        6.  **(MVP 暂不做) 工单SLA、满意度评价、工单转派。**
    *   **关键数据点:** 工单ID, 提交人ID, 标题, 描述, 分类, 附件链接, 创建时间, 状态, 处理人ID, 回复记录 (回复人, 回复内容, 回复时间)。

**模块D: 财务结算与对账 (基础版)**

*   **D.1 费用记录与支付提醒 (简化版)**
    *   **用户故事:**
        *   作为总部财务专员，我希望能记录加盟商应付的货款金额，并能标记其支付状态（基于线下收款事实）。
        *   作为加盟商，我希望能看到我的待付货款信息和历史货款支付记录（基于总部标记）。
    *   **功能需求 (FR):**
        1.  **FR-D.1.1 (HQ Finance/HQ Ops):** 在订单被标记为“已发货”或某个确认状态后，系统自动（或由HQ Ops/Finance手动触发）生成对应的货款应付记录，关联到加盟商和订单。
        2.  **FR-D.1.2 (HQ Finance):** HQ Finance 角色可访问此货款记录列表，并手动更新货款支付状态（如：待支付、已支付）。可记录支付日期和备注。
        3.  **FR-D.1.3 (Franchisee):** 可查看自己的待支付货款列表（显示：应付金额、对应订单简要信息/订单号、生成日期）。
        4.  **FR-D.1.4 (Franchisee):** 可查看历史货款支付记录列表（显示：已付金额、对应订单、支付日期）。
        5.  **(MVP 暂不做) 在线支付集成和自动对账。** 支付和对账主要依赖线下，平台做记录和提醒。
    *   **关键数据点:** 货款记录ID, 关联订单ID, 加盟商ID, 应付金额, 币种, 生成日期, 支付状态, 支付日期, 操作人, 备注。

*   **D.2 基础对账提醒**
    *   **用户故事:**
        *   作为总部财务专员，我希望能每月向加盟商发送一个简单的对账提醒，告知其本月发生的货款总额及当前未付总额。
        *   作为加盟商，我希望能收到月度货款汇总信息，以便与自己的记录核对。
    *   **功能需求 (FR):**
        1.  **FR-D.2.1 (HQ Finance/Admin):** 系统每月初（或由HQ Finance手动触发）能汇总上一个自然月内每个加盟商已生成（或已发货）订单的总货款金额，以及截止当前该加盟商所有未支付货款的总额。
        2.  **FR-D.2.2 (HQ Finance):** HQ Finance 可查看此汇总信息，并可通过系统内消息或邮件（手动复制粘贴或半自动生成文本）发送给加盟商作为对账参考。
        3.  **(MVP 暂不做) 详细对账单生成和在线确认。**
    *   **关键数据点:** 月度应付货款汇总金额, 当前未付货款总额, 加盟商ID, 统计月份。

**模块E: 巡店与品控管理 (基础版)**

*   **E.1 基础巡店记录**
    *   **用户故事:**
        *   作为总部区域督导，我希望能使用手机或平板记录对某个加盟店的巡店情况，包括一些关键检查项的符合情况和问题描述，并附带照片。
        *   作为加盟商，我希望能看到督导对我的门店的巡检反馈，了解存在的问题。
    *   **功能需求 (FR):**
        1.  **FR-E.1.1 (Admin/HQ Supervisor):** 可预设一个简单的巡店检查清单模板（包含5-10个核心检查项，如：门店清洁度、商品陈列规范、员工服务礼仪、VI执行情况等，每个检查项可设定结果类型：是/否/不适用，或简单评分1-5分 - MVP建议是/否）。
        2.  **FR-E.1.2 (HQ Supervisor):** 移动端友好界面。选择要巡检的加盟门店，基于预设的模板进行巡店。
        3.  **FR-E.1.3 (HQ Supervisor):** 对每个检查项进行结果记录，对不符合项或需要说明的事项可填写文字描述，可上传1-3张与问题点相关的照片。
        4.  **FR-E.1.4 (HQ Supervisor):** 填写整体巡店总结或建议（文本框）。
        5.  **FR-E.1.5 (HQ Supervisor):** 提交巡店记录。
        6.  **FR-E.1.6 (Franchisee):** 可查看针对本店的历史巡店记录列表（巡店日期、巡店员、总体评价-若有），点击可查看详细巡店报告（包含各检查项结果、问题描述和照片、总结建议）。
        7.  **(MVP 暂不做) 复杂评分体系、问题整改闭环流程、巡店计划与排班、自动生成报告PDF。**
    *   **关键数据点:** 巡店记录ID, 巡店员ID, 被巡门店ID, 巡店日期, 巡店模板ID, 检查项结果 (JSON或单独表存储), 问题描述, 问题照片链接, 整体总结。

**模块F: 总部公告与沟通 (基础版)**

*   **F.1 总部公告发布与查阅**
    *   **用户故事:**
        *   作为总部运营专员或管理员，我希望能向所有或特定加盟商发布重要通知（如节假日安排、新品上市通知、政策解读），并最好能知道他们是否已读。
        *   作为加盟商，我希望能在一个集中的地方及时收到并查阅总部的各类公告。
    *   **功能需求 (FR):**
        1.  **FR-F.1.1 (HQ Ops/Admin):** 创建公告：填写公告标题、正文内容（支持简单的富文本编辑，如加粗、列表、链接，或纯Markdown），可上传1个附件（如PDF文件）。
        2.  **FR-F.1.2 (HQ Ops/Admin):** 选择公告接收对象（MVP可选：全体已签约加盟商，或手动从加盟商列表中多选）。
        3.  **FR-F.1.3 (HQ Ops/Admin):** 可设置公告重要等级（普通/重要 - 重要公告在列表或通知中可有特殊标记）。
        4.  **FR-F.1.4 (HQ Ops/Admin):** 发布公告。发布后不可修改，如需修改需作废重发（或MVP简化为可编辑）。
        5.  **FR-F.1.5 (Franchisee):** 登录后在“通知公告”区域看到新公告列表（按发布时间倒序，重要公告置顶或高亮）。列表显示标题、发布时间、重要等级。
        6.  **FR-F.1.6 (Franchisee):** 点击公告标题可查看公告详情及附件（若有）。
        7.  **FR-F.1.7 (Franchisee):** 阅读公告后，可手动点击“标记为已读”按钮。
        8.  **FR-F.1.8 (HQ Ops/Admin):** 可查看已发布公告的阅读统计（已读加盟商数量/列表，未读加盟商数量/列表 - 基于加盟商手动标记）。
        9.  **(MVP 暂不做) 公告分类、定时发布、强制弹窗阅读、已读回执强制。**
    *   **关键数据点:** 公告ID, 标题, 内容, 附件链接, 发布人ID, 发布时间, 接收对象列表, 重要等级, 已读加盟商列表。

**模块 Core: 用户与权限管理 (基础版)**

*   **Core.1 用户认证与角色**
    *   **功能需求 (FR):**
        1.  **FR-Core.1.1:** 支持用户注册（仅限意向加盟商 Applicant，注册后需管理员激活或审核通过才可登录）。
        2.  **FR-Core.1.2 (Admin):** 管理员可创建总部员工账号（HQ Recruiter, HQ Ops, HQ Supervisor, HQ Finance, Admin）并分配角色。
        3.  **FR-Core.1.3 (Admin):** 管理员可管理加盟商账号（如：在合同签署后将其从 Applicant 激活/转换为 Franchisee 角色，或禁用账号）。
        4.  **FR-Core.1.4:** 所有用户支持邮箱/密码登录。提供“忘记密码”功能。
        5.  **FR-Core.1.5:** 系统内定义清晰的角色：Applicant, Franchisee, HQ Recruiter, HQ Ops, HQ Supervisor, HQ Finance, Admin。
        6.  **FR-Core.1.6:** 基于角色实现严格的数据访问权限和功能操作权限（通过 Supabase RLS 和前端逻辑控制）。
            *   Applicant: 只能提交申请，查看自己申请状态，签署合同。
            *   Franchisee: 只能查看和操作自己门店的订单、工单、财务信息、巡店报告、接收公告。
            *   HQ Recruiter: 管理加盟申请，发起合同。
            *   HQ Ops: 管理订单、工单、发布公告。
            *   HQ Supervisor: 进行巡店记录，查看自己负责的巡店报告。
            *   HQ Finance: 管理货款记录，发起对账提醒。
            *   Admin: 最高权限，管理用户、角色、系统配置等。
    *   **关键数据点:** 用户ID, 邮箱, 加密密码, 角色, 关联加盟商ID (若为Franchisee), 创建时间, 最后登录时间, 状态 (启用/禁用)。

---

**3. 技术栈选择**

*   **3.1 后端 (Backend): Supabase**
    *   **数据库:** Supabase PostgreSQL (表结构设计需覆盖所有模块数据)
    *   **认证:** Supabase Auth (邮箱/密码登录, 角色管理通过用户 metadata + RLS)
    *   **存储:** Supabase Storage (资质文件、合同、工单附件、巡店照片、公告附件)
    *   **Serverless Functions:** Supabase Edge Functions (Deno/TypeScript) - 用于处理:
        *   简单的审批流转通知逻辑 (邮件/系统内通知)。
        *   与第三方电子签 API 对接。
        *   （轻度）订单生成后的货款记录触发。
        *   （轻度）月度货款汇总逻辑。
        *   （轻度）公告已读状态更新或通知逻辑。
        *   可能的后台定时任务 (如数据清理、提醒)。
*   **3.2 前端 (Frontend): Next.js (TypeScript)**
	*   **设计原则**：使用Bento Grid风格的视觉设计，#00B0B9和#FF9800两种颜色作为高亮
    *   **UI 框架/库:** Tailwind CSS + Shadcn/ui (推荐，提供UI组件基础，加速开发)。
    *   **状态管理:** Zustand 或 Jotai (轻量级，适合 Next.js App Router)。
    *   **数据请求:** Supabase Client JS Library (`@supabase/supabase-js`), SWR 或 React Query (用于数据缓存、自动刷新、乐观更新等)。
    *   **表单处理:** React Hook Form + Zod (用于表单校验)。
    *   **富文本编辑器 (公告模块):** TipTap (基于ProseMirror, 可定制性强) 或 a simpler Markdown editor like `react-markdown` with an input field.
    *   **图表库 (数据看板):** Recharts 或 Chart.js (轻量且够用)。
    *   **文件上传组件:** `react-dropzone` 或集成UI库的上传组件，配合Supabase Storage JS SDK。
*   **3.3 部署 (Deployment): Vercel**
    *   与 Next.js 和 Supabase 集成良好。
    *   CI/CD, 全球 CDN, Serverless Functions (可作为 Supabase Functions 补充或处理特定前端相关的后端逻辑)。
*   **3.4 第三方集成 (MVP 核心):**
    *   **电子签章:** 选择一家提供简单API的服务商 (e.g., eSignLite, HelloSign, or国内服务商的基础版API)。

---

**4. 非功能性需求 (MVP 关注点)**

*   **4.1 易用性:** 尽管功能模块增多，仍需努力保持界面简洁直观，核心流程清晰。提供必要的提示和引导。
*   **4.2 可靠性:** 所有核心模块功能稳定可用，数据准确性高。
*   **4.3 安全性:**
    *   用户数据（特别是个人信息、合同、财务数据）安全存储和传输 (HTTPS)。
    *   Supabase RLS (Row Level Security) 严格配置并测试，确保数据按角色正确隔离。
    *   前端和后端进行输入校验，防止常见 Web 攻击 (XSS, SQL注入 - Supabase ORM层面有防护)。
    *   定期备份 Supabase 数据库。
*   **4.4 性能:**
    *   对于 MVP 阶段的用户量（预计中小型），关键页面加载和操作响应应在可接受范围内 (如3-5秒内)。
    *   数据库查询进行基础优化，对常用查询字段建立索引。
*   **4.5 移动端适配:**
    *   对于加盟商和督导经常使用的功能（如查看订单、提交工单、巡店记录），界面应能在主流移动设备浏览器上良好显示和操作 (响应式设计)。

---

**5. 风险与挑战 (完整扩展版 MVP)**

*   **范围过大导致交付延期:** 这是最主要的风险。如此多的模块和功能点，即使是MVP简化版，也需要相当的开发和测试时间。
*   **RLS 设计与实现的复杂度:** 角色和数据模块增多，RLS 规则会非常复杂，容易出错，需要大量测试。
*   **用户体验设计难度增加:** 需在有限的MVP资源下，为多个不同角色设计既能满足其核心需求又不失一致性的用户体验。
*   **测试工作量巨大:** 每个模块、每个角色、每个功能点都需要测试，跨模块的流程测试也必不可少。
*   **团队协作与沟通成本:** 功能点多，涉及不同业务方，对团队沟通和项目管理要求更高。

---

**开发的建议：**

1.  **分解任务，明确优先级：** 将每个模块下的每个FR都视为一个可独立开发和测试的任务。在模块内部，也可以进一步细分。**强烈建议在团队内部对这些模块再进行一次优先级排序，即使都是MVP，也可以分批交付。** 例如，先确保A, B, C模块完全跑通，再逐步上线D, E, F。
2.  **数据库设计是核心中的核心：** 在开始编码前，投入足够时间设计 Supabase 的数据库表结构、字段类型、关系、索引和 RLS 策略草案。这部分设计质量直接影响后续所有开发。
3.  **共享组件与类型定义：** 在前端大量使用可复用的UI组件。前后端共享数据类型定义 (e.g., using TypeScript types for API payloads and Supabase table rows) 可以减少错误。
4.  **API 接口先行（或与前端并行）：** 清晰定义 Supabase Functions (如果需要自定义逻辑) 或直接通过 Supabase JS SDK 操作数据库的接口。
5.  **详细的用户故事和验收标准：** 为每个FR编写清晰的用户故事，并明确验收标准，这将极大帮助AI辅助工具理解需求并生成更准确的代码。
6.  **持续集成与小步快跑测试：** 每完成一个小功能点或一个用户故事就进行集成和测试，尽早发现和修复问题。
7.  **为不同角色分别考虑用户流：** 在设计和测试时，始终从特定角色的视角出发，走通其核心操作流程。
